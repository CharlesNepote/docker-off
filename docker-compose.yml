version: "3.7"
services:
  mongo:
    image: mongo:4.0
    container_name: mongo
    ports:
      - 27017:27017
  apache:
    build: docker
    container_name: apache
    depends_on: [mongo]
    ports:
      - 8080:8080
    volumes:
      - type: bind
        source: ./docker/etc/apache2/conf-enabled
        target: /etc/apache2/conf-enabled
      - type: bind
        source: ./docker/etc/apache2/sites-enabled
        target: /etc/apache2/sites-enabled
      - type: bind
        source: ./docker/etc/apache2/ports.conf
        target: /etc/apache2/ports.conf
      - type: bind
        source: ./openfoodfacts-server
        target: /var/www/html
      - type: bind
        source: ./openfoodfacts-server/lib/ProductOpener/Config_off.pm
        target: /var/www/html/lib/ProductOpener/Config.pm
      - type: bind
        source: ./openfoodfacts-server/lib/ProductOpener/Config2_sample_docker.pm
        target: /var/www/html/lib/ProductOpener/Config2.pm
  nginx:
    image: nginx:1.15
    container_name: nginx
    depends_on: [apache]
    ports:
      - 80:80
    volumes:
      - type: bind
        source: ./openfoodfacts-server
        target: /var/www/html
      - type: bind
        source: ./docker/etc/nginx/conf.d
        target: /etc/nginx/conf.d
